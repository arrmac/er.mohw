/*! grafana - v1.7.0 - 2014-08-12
 * Copyright (c) 2014 Torkel Ã–degaard; Licensed Apache License */

define(["./helpers","services/influxdb/influxdbDatasource"],function(a){describe("InfluxDatasource",function(){var b=new a.ServiceTestContext;beforeEach(module("grafana.services")),beforeEach(b.createService("InfluxDatasource")),describe("When querying influxdb with one target using query editor target spec",function(){var a,c="/series?p=mupp&q=select++mean(value)+from+%22test%22+where++time+%3E+now()+-+1h+++++group+by+time()++order+asc&time_precision=s",d={range:{from:"now-1h",to:"now"},targets:[{series:"test",column:"value","function":"mean"}]},e=[{columns:["time","sequence_nr","value"],name:"test",points:[[10,1,1]]}];beforeEach(function(){var f=new b.service({urls:[""],user:"test",password:"mupp"});b.$httpBackend.expect("GET",c).respond(e),f.query(b.filterSrv,d).then(function(b){a=b}),b.$httpBackend.flush()}),it("should generate the correct query",function(){b.$httpBackend.verifyNoOutstandingExpectation()}),it("should return series list",function(){expect(a.data.length).to.be(1),expect(a.data[0].target).to.be("test.value")})}),describe("When querying influxdb with one raw query",function(){var a,c="/series?p=mupp&q=select+value+from+series+where+time+%3E+now()+-+1h+and+time+%3E+1&time_precision=s",d={range:{from:"now-1h",to:"now"},targets:[{query:"select value from series where time > 1",rawQuery:!0}]},e=[];beforeEach(function(){var f=new b.service({urls:[""],user:"test",password:"mupp"});b.$httpBackend.expect("GET",c).respond(e),f.query(b.filterSrv,d).then(function(b){a=b}),b.$httpBackend.flush()}),it("should generate the correct query",function(){b.$httpBackend.verifyNoOutstandingExpectation()})})})});